# Story 5.4: Extended Content Field with Formatting Hints

## Status

Done

## Story

**As a** content creator,
**I want** formatting hints and guidance for LinkedIn posts,
**so that** I can create professional, well-structured LinkedIn content.

## Acceptance Criteria

1. The LinkedIn text area displays a subtle formatting toolbar or hint panel.
2. Formatting hints include: "Use line breaks for readability", "Add emojis for engagement", "Include hashtags at the end".
3. A "Tips" button/icon displays a popover with LinkedIn best practices (e.g., "First 2-3 lines are critical, longer posts get truncated").
4. The LinkedIn text area supports basic markdown preview (optional enhancement): line breaks, bold, bullet points.
5. Formatting hints are non-intrusive and can be dismissed/minimized.
6. Hints are context-aware: e.g., suggest adding hashtags if none are present in content > 100 characters.
7. All formatting guidance is informational only and does not enforce rules.

## Tasks / Subtasks

- [x] **Task 1: Create LinkedInFormattingHints component** (AC: 1, 2, 5)
  - [x] Create new component `components/features/LinkedInFormattingHints.tsx`
  - [x] Define props: `content: string`, `isVisible: boolean`, `onDismiss: () => void`
  - [x] Design subtle, non-intrusive hint panel (e.g., small card below LinkedIn text area)
  - [x] Display static formatting hints:
    - "Use line breaks for readability"
    - "Add emojis for engagement"
    - "Include hashtags at the end"
  - [x] Add minimize/dismiss button (small 'x' icon)
  - [x] Use subdued styling (light background, small text, borderless or subtle border)
  - [x] Ensure hints are collapsible and remember state (use localStorage or component state)

- [x] **Task 2: Implement context-aware hint logic** (AC: 6)
  - [x] Analyze `content` prop to determine which hints to show
  - [x] Detect if content has hashtags (regex: `/#\w+/g`)
  - [x] If content length > 100 characters AND no hashtags detected:
    - Show additional hint: "Consider adding relevant hashtags"
  - [x] Detect if content has line breaks (check for `\n` characters)
  - [x] If content length > 200 characters AND no line breaks:
    - Show additional hint: "Add line breaks to improve readability"
  - [x] Make hints dynamic based on content analysis
  - [x] Ensure hints update as user types (but not too frequently - consider debounce if needed)

- [x] **Task 3: Create LinkedIn Tips popover** (AC: 3)
  - [x] Add "Tips" button/icon near LinkedIn text area label or hint panel
  - [x] Use shadcn/ui Popover component for tips display
  - [x] Populate popover with LinkedIn best practices:
    - "First 2-3 lines are critical - LinkedIn truncates posts after ~140 characters in feed"
    - "Use line breaks to create visual hierarchy"
    - "Posts with 3-5 hashtags tend to perform well"
    - "Tag relevant people or companies to increase reach"
    - "Emoji can increase engagement, but use sparingly"
    - "Ask questions to encourage comments"
  - [x] Style popover for readability (bulleted list, clear headings)
  - [x] Ensure popover is accessible (keyboard navigable, proper ARIA attributes)
  - [x] Position popover to not obstruct text area

- [ ] **Task 4: Add optional markdown preview (Enhancement)** (AC: 4)
  - [ ] Create toggle button "Preview" near LinkedIn text area
  - [ ] When enabled, display a preview panel showing rendered markdown
  - [ ] Implement basic markdown rendering:
    - Line breaks: `\n` → `<br>`
    - Bold: `**text**` → `<strong>text</strong>`
    - Bullet points: Lines starting with `-` or `*` → `<li>` items
  - [ ] Use a lightweight markdown library (e.g., `marked` or `react-markdown`) or custom regex
  - [ ] Note: LinkedIn doesn't support markdown natively, so this is visual guidance only
  - [ ] Display disclaimer: "Preview is approximate - LinkedIn doesn't support markdown"
  - [ ] Allow toggling between edit and preview modes

- [x] **Task 5: Integrate LinkedInFormattingHints into DualPlatformTextFields** (AC: 1, 2, 5, 6)
  - [x] In `DualPlatformTextFields.tsx`, import `LinkedInFormattingHints` component
  - [x] Add state to track hint panel visibility: `const [showLinkedInHints, setShowLinkedInHints] = useState(true);`
  - [x] Render `<LinkedInFormattingHints>` component below LinkedIn text area
  - [x] Pass `linkedInContent` as the `content` prop for context-aware hints
  - [x] Pass visibility state and dismiss handler
  - [x] Store hint visibility preference in localStorage: `linkedin-hints-visible`
  - [x] On component mount, check localStorage to restore user's preference

- [x] **Task 6: Ensure hints are informational only** (AC: 7)
  - [x] Verify that hints do NOT block form submission
  - [x] Verify that hints do NOT modify user content automatically
  - [x] Ensure dismissing hints doesn't affect content or validation
  - [x] All hints should use language like "Consider..." or "Tip:" to indicate they're suggestions
  - [x] No "error" or "warning" styling - use neutral, helpful tone

- [x] **Task 7: Add unit tests for LinkedInFormattingHints** (AC: 1-7)
  - [x] Create test file `components/features/LinkedInFormattingHints.test.tsx`
  - [x] Test: Component renders with default hints
  - [x] Test: Dismiss button hides the hint panel
  - [x] Test: Context-aware hashtag hint appears when content > 100 chars and no hashtags
  - [x] Test: Context-aware line break hint appears when content > 200 chars and no line breaks
  - [x] Test: Hints do not appear for short content
  - [x] Test: Tips popover opens and closes correctly
  - [x] Test: Markdown preview toggle works (if implemented)

- [x] **Task 8: Add integration tests for hint panel** (AC: 5, 6, 7)
  - [x] Test: Hint panel visibility is restored from localStorage on mount
  - [x] Test: Dismissing hints persists preference in localStorage
  - [x] Test: Hints update as user types in LinkedIn text area
  - [x] Test: Form submission works regardless of hint visibility
  - [x] Test: Hints never modify content automatically

## Dev Notes

### Previous Story Context

Story 5.1 created the `DualPlatformTextFields.tsx` component. Story 5.2 added smart pre-population. Story 5.3 added character counting and validation. This story enhances the LinkedIn text area specifically with formatting guidance to help users create professional, engaging LinkedIn content.

### Frontend Architecture

[Source: docs/architecture/frontend-architecture.md#Component Architecture]

- **Component Locations**:
  - Create new `components/features/LinkedInFormattingHints.tsx`
  - Enhance `components/features/DualPlatformTextFields.tsx` (integrate hints)
- **UI Primitives**: Use shadcn/ui Popover, Button, Card components
- **State Management**: Local React state for hint visibility, localStorage for persistence

### Tech Stack

[Source: docs/architecture/tech-stack.md]

- **Frontend Framework**: Next.js 15.5.4, React 19
- **UI Component Library**: shadcn/ui - Use Popover for tips, Card for hint panel
- **Styling**: Tailwind CSS 4 - Use subtle, non-intrusive styling
- **Language**: TypeScript

### LinkedIn Best Practices

**Content Structure Best Practices** (for Tips popover):

1. **Hook in First 2-3 Lines**: LinkedIn's mobile feed shows only ~140 characters before "...see more". The opening must grab attention.
2. **Line Breaks for Readability**: Dense blocks of text are hard to read on mobile. Use short paragraphs with line breaks.
3. **Hashtag Strategy**: 3-5 hashtags is optimal for reach without looking spammy. Place at the end.
4. **Emoji Usage**: 1-3 emoji can increase engagement, but excessive emoji looks unprofessional.
5. **Call-to-Action**: End with a question or request for engagement to boost comments.
6. **Tagging**: Mention relevant people/companies to increase visibility.

### Implementation Patterns

**Context-Aware Hint Logic**:

```typescript
// In LinkedInFormattingHints component

interface Hint {
  id: string;
  text: string;
  condition: (content: string) => boolean;
}

const contextAwareHints: Hint[] = [
  {
    id: "add-hashtags",
    text: "Consider adding relevant hashtags",
    condition: (content) => content.length > 100 && !/#\w+/.test(content),
  },
  {
    id: "add-line-breaks",
    text: "Add line breaks to improve readability",
    condition: (content) => content.length > 200 && !content.includes("\n"),
  },
];

const activeHints = contextAwareHints.filter((hint) => hint.condition(content));
```

**Hint Panel Component Structure**:

```typescript
interface LinkedInFormattingHintsProps {
  content: string;
  isVisible: boolean;
  onDismiss: () => void;
}

export function LinkedInFormattingHints({
  content,
  isVisible,
  onDismiss
}: LinkedInFormattingHintsProps) {
  if (!isVisible) return null;

  const contextHints = getContextAwareHints(content);

  return (
    <Card className="p-3 bg-blue-50 border-blue-200 mt-2">
      <div className="flex justify-between items-start">
        <div className="text-sm text-gray-700">
          <p className="font-medium mb-1">Formatting Tips:</p>
          <ul className="list-disc list-inside space-y-1">
            <li>Use line breaks for readability</li>
            <li>Add emojis for engagement</li>
            <li>Include hashtags at the end</li>
            {contextHints.map((hint) => (
              <li key={hint.id} className="text-orange-600">
                {hint.text}
              </li>
            ))}
          </ul>
        </div>
        <Button
          variant="ghost"
          size="sm"
          onClick={onDismiss}
          aria-label="Dismiss hints"
        >
          ×
        </Button>
      </div>
    </Card>
  );
}
```

**LocalStorage Persistence Pattern**:

```typescript
// In DualPlatformTextFields component

const [showLinkedInHints, setShowLinkedInHints] = useState(() => {
  if (typeof window !== "undefined") {
    const stored = localStorage.getItem("linkedin-hints-visible");
    return stored === null ? true : stored === "true";
  }
  return true;
});

const handleDismissHints = () => {
  setShowLinkedInHints(false);
  localStorage.setItem("linkedin-hints-visible", "false");
};
```

**Markdown Preview Pattern** (Optional):

```typescript
// Basic markdown rendering (if not using a library)

function renderSimpleMarkdown(content: string): string {
  return content
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold
    .replace(/\n/g, '<br>') // Line breaks
    .replace(/^[*-]\s+(.*)$/gm, '<li>$1</li>'); // Bullet points
}

// Or use react-markdown library for more robust rendering
import ReactMarkdown from 'react-markdown';

<ReactMarkdown>{linkedInContent}</ReactMarkdown>
```

### Testing

[Source: docs/architecture/testing-strategy.md#Unit Testing]

- **Test Level**: Unit tests for hint logic, Component tests for UI
- **Tools**: Jest with React Testing Library
- **Testing Focus**:
  - Context-aware hint logic (hashtag detection, line break detection)
  - Hint panel visibility and dismissal
  - Tips popover functionality
  - LocalStorage persistence
  - Markdown preview rendering (if implemented)

**Testing Requirements**:

- Test file: `components/features/LinkedInFormattingHints.test.tsx`
- Mock localStorage for persistence tests
- Test regex patterns for hashtag/line break detection
- Verify hints never block form submission or modify content

### Accessibility Considerations

- Use semantic HTML for hint panel (e.g., `<aside>` or `role="complementary"`)
- Ensure Tips popover is keyboard accessible (tab to open, ESC to close)
- Add `aria-label` to dismiss button
- Ensure hint text has sufficient color contrast
- Consider `aria-live` for dynamic context-aware hints (but be cautious of announcement overload)

### Implementation Notes

1. **Non-Intrusive Design**: Hints should be helpful but not annoying. Use subtle styling and make them easy to dismiss permanently.

2. **Context-Aware Timing**: Consider debouncing context-aware hint checks (e.g., 500ms) to avoid excessive re-renders as user types.

3. **LinkedIn's Feed Truncation**: The "see more" link appears around 140 characters in mobile feed, ~220 on desktop. This is a critical best practice to communicate.

4. **Markdown Preview Disclaimer**: If implementing markdown preview, make it clear that LinkedIn doesn't support markdown. This is a visual aid only for planning content structure.

5. **Future Enhancement**: Consider adding a "Learn More" link in the Tips popover to external LinkedIn content strategy resources.

6. **User Preference**: Store hint visibility in localStorage so users who dismiss hints don't see them again unless they manually re-enable them.

7. **Mobile Responsiveness**: Ensure hint panel and tips popover are mobile-friendly, as users may schedule posts from mobile devices.

## Change Log

| Date       | Version | Description                 | Author       |
| :--------- | :------ | :-------------------------- | :----------- |
| 2025-11-03 | 1.0     | Initial story draft created | Scrum Master |

## Dev Agent Record

### Agent Model Used

claude-sonnet-4-5-20250929

### Debug Log References

No debug log entries required. Implementation completed without blocking issues.

### Completion Notes

Successfully implemented LinkedIn formatting hints feature with all required acceptance criteria:

**Completed Tasks:**

- Created LinkedInFormattingHints component with static hints, context-aware logic, and Tips popover
- Integrated into DualPlatformTextFields with localStorage persistence
- Implemented context-aware hints: hashtags (>100 chars) and line breaks (>200 chars)
- Added comprehensive unit tests (24 tests) and integration tests (15 tests) - all passing
- Ensured hints are informational only with no form blocking or content modification

**Task 4 (Markdown Preview) Status:**
Marked as optional enhancement and not implemented. This was explicitly noted as "optional" in AC 4 and deprioritized to deliver core functionality. Can be added in future enhancement if needed.

**Testing Results:**

- Unit tests: 24/24 passing (LinkedInFormattingHints.test.tsx)
- Integration tests: 15/15 passing (DualPlatformTextFields.test.tsx - LinkedIn Formatting Hints Integration section)
- Linting: Clean, no errors introduced
- Pre-existing test failures (5) in character counter validation are unrelated to this story

**Key Implementation Details:**

- Hints use blue theme styling (non-intrusive)
- Context-aware hints highlighted in orange for visibility
- localStorage key: `linkedin-hints-visible`
- Hints appear below character counter in LinkedIn section only
- Tips popover includes 6 LinkedIn best practices
- All hints use suggestive language ("Consider...", "Add...")

### File List

**New Files:**

- components/features/LinkedInFormattingHints.tsx
- components/features/**tests**/LinkedInFormattingHints.test.tsx

**Modified Files:**

- components/features/DualPlatformTextFields.tsx
- components/features/**tests**/DualPlatformTextFields.test.tsx

## QA Results

_To be populated by QA agent_
