# Story 5.5: Preview Mode for Both Platforms Side-by-Side

## Status

Draft

## Story

**As a** content creator,
**I want** to preview how my content will appear on Twitter and LinkedIn simultaneously,
**so that** I can ensure optimal presentation before scheduling.

## Acceptance Criteria

1. A "Preview" button is displayed in the post creation form.
2. Clicking "Preview" opens a modal showing side-by-side mockups of the Twitter and LinkedIn post appearance.
3. Twitter preview mimics the Twitter UI: avatar placeholder, content, character count visible, truncation if applicable.
4. LinkedIn preview mimics the LinkedIn feed UI: larger format, line breaks rendered, "see more" truncation at ~300 characters visible.
5. If a URL is provided, the preview shows "URL will be posted as a comment/reply" for each platform.
6. Preview updates dynamically if users make edits without closing the modal.
7. Preview modal is responsive: side-by-side on desktop, stacked on mobile.

## Tasks / Subtasks

- [ ] **Task 1: Create PreviewModal component** (AC: 1, 2, 7)
  - [ ] Create new component `components/features/PreviewModal.tsx`
  - [ ] Use shadcn/ui Dialog component as the base modal
  - [ ] Define props: `isOpen: boolean`, `onClose: () => void`, `twitterContent: string`, `linkedInContent: string`, `url?: string`, `twitterEnabled: boolean`, `linkedInEnabled: boolean`
  - [ ] Implement responsive layout:
    - Desktop (lg+): Two-column grid (side-by-side previews)
    - Mobile: Single column (stacked previews)
  - [ ] Add modal header with "Preview" title and close button
  - [ ] Ensure modal is accessible (keyboard navigation, focus trap, ESC to close)

- [ ] **Task 2: Create TwitterPreview component** (AC: 3, 5)
  - [ ] Create new component `components/features/previews/TwitterPreview.tsx`
  - [ ] Define props: `content: string`, `url?: string`, `characterCount: number`
  - [ ] Design mockup mimicking Twitter UI:
    - Avatar placeholder (generic circle with initial or icon)
    - Username placeholder (e.g., "Your Name @yourhandle")
    - Timestamp placeholder (e.g., "now")
    - Content text with proper line breaks
    - Twitter action buttons (like, retweet, reply - non-functional, visual only)
  - [ ] Display character count in bottom-right corner (styled like Twitter)
  - [ ] Show content truncation warning if content exceeds 280 chars (visually indicate with "...")
  - [ ] If URL provided, show badge/label: "URL will be posted as a reply"
  - [ ] Use Twitter brand colors (#1DA1F2) for accents

- [ ] **Task 3: Create LinkedInPreview component** (AC: 4, 5)
  - [ ] Create new component `components/features/previews/LinkedInPreview.tsx`
  - [ ] Define props: `content: string`, `url?: string`
  - [ ] Design mockup mimicking LinkedIn UI:
    - Avatar placeholder (generic circle)
    - Name and headline placeholder (e.g., "Your Name" / "Your Headline")
    - Timestamp placeholder (e.g., "Just now")
    - Content text with line breaks rendered as actual breaks
    - LinkedIn action buttons (like, comment, share - non-functional, visual only)
  - [ ] Show "see more" truncation at ~140 characters (first 2-3 lines):
    - Display first 140 chars followed by "...see more"
    - User can click "see more" to expand preview (simulating LinkedIn behavior)
  - [ ] If URL provided, show badge/label: "URL will be posted as first comment"
  - [ ] Use LinkedIn brand colors (#0A66C2) for accents

- [ ] **Task 4: Integrate preview components into PreviewModal** (AC: 2, 3, 4, 7)
  - [ ] In `PreviewModal`, conditionally render `TwitterPreview` if `twitterEnabled`
  - [ ] In `PreviewModal`, conditionally render `LinkedInPreview` if `linkedInEnabled`
  - [ ] If only one platform is enabled, show single preview (centered)
  - [ ] If both platforms enabled, show side-by-side (or stacked on mobile)
  - [ ] Pass content, URL, and other necessary props to each preview component
  - [ ] Add platform labels above each preview ("Twitter" / "LinkedIn")

- [ ] **Task 5: Add "Preview" button to post creation form** (AC: 1)
  - [ ] In `DualPlatformTextFields.tsx` or parent form component, add "Preview" button
  - [ ] Position button prominently (e.g., near "Schedule" button in form actions area)
  - [ ] Use shadcn/ui Button with Eye icon (from lucide-react or similar)
  - [ ] Button opens PreviewModal when clicked
  - [ ] Add state to track modal open/close: `const [isPreviewOpen, setIsPreviewOpen] = useState(false);`

- [ ] **Task 6: Implement dynamic preview updates** (AC: 6)
  - [ ] Pass current form state (twitterContent, linkedInContent, url) to PreviewModal
  - [ ] Previews should automatically re-render when props change
  - [ ] No need for "Refresh" button - updates happen automatically via React re-rendering
  - [ ] Ensure character counting in Twitter preview updates in real-time
  - [ ] Ensure LinkedIn "see more" truncation recalculates dynamically

- [ ] **Task 7: Handle edge cases in preview** (AC: 3, 4, 5)
  - [ ] Empty content: Show placeholder text "No content to preview"
  - [ ] Very long content: Twitter shows truncation, LinkedIn shows full content with "see more"
  - [ ] URL handling: Display URL metadata badge/label clearly
  - [ ] Emoji and special characters: Render correctly in preview
  - [ ] Line breaks: Preserve in both previews (especially important for LinkedIn)

- [ ] **Task 8: Add unit tests for preview components** (AC: 2-7)
  - [ ] Create test file `components/features/PreviewModal.test.tsx`
  - [ ] Test: PreviewModal opens and closes correctly
  - [ ] Test: TwitterPreview renders with correct content
  - [ ] Test: LinkedInPreview renders with correct content
  - [ ] Test: Character count displays in Twitter preview
  - [ ] Test: "see more" truncation works in LinkedIn preview
  - [ ] Test: URL labels display correctly when URL is provided
  - [ ] Test: Preview updates when content props change
  - [ ] Test: Responsive layout (side-by-side vs stacked)
  - [ ] Test: Previews show/hide based on platform enabled flags

## Dev Notes

### Previous Story Context

Stories 5.1-5.4 built the dual-platform text field UI with character counting, smart pre-population, and formatting hints. This story adds a preview feature to help users visualize how their content will appear on each platform before scheduling.

### Frontend Architecture

[Source: docs/architecture/frontend-architecture.md#Component Architecture]

- **Component Locations**:
  - Create `components/features/PreviewModal.tsx`
  - Create `components/features/previews/TwitterPreview.tsx`
  - Create `components/features/previews/LinkedInPreview.tsx`
  - Enhance `components/features/DualPlatformTextFields.tsx` or parent form (add Preview button)
- **UI Primitives**: Use shadcn/ui Dialog for modal, Button for preview button, Card for preview containers
- **State Management**: Local React state for modal visibility; props for content data

### Tech Stack

[Source: docs/architecture/tech-stack.md]

- **Frontend Framework**: Next.js 15.5.4, React 19
- **UI Component Library**: shadcn/ui - Dialog, Button, Card, Avatar components
- **Styling**: Tailwind CSS 4 - Use for responsive layout and platform-specific styling
- **Icons**: lucide-react (commonly used with shadcn/ui) for Eye icon, social platform icons
- **Language**: TypeScript

### UI Mockup Design

**Twitter Preview Mockup Structure**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Avatar] Your Name @yourhandle      â”‚
â”‚          â€¢ now                      â”‚
â”‚                                     â”‚
â”‚ [Post content text here...]         â”‚
â”‚ [Line breaks preserved]             â”‚
â”‚                                     â”‚
â”‚ [â™¥ï¸ ðŸ’¬ ðŸ” share icons]              â”‚
â”‚                      280 chars      â”‚
â”‚                                     â”‚
â”‚ â„¹ï¸ URL will be posted as a reply   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**LinkedIn Preview Mockup Structure**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Avatar] Your Name                  â”‚
â”‚          Your Headline              â”‚
â”‚          Just now                   â”‚
â”‚                                     â”‚
â”‚ [Post content text here...]         â”‚
â”‚ [Line breaks rendered as breaks]    â”‚
â”‚ [First ~140 chars visible]          â”‚
â”‚ ...see more                         â”‚
â”‚                                     â”‚
â”‚ [ðŸ‘ ðŸ’¬ ðŸ” send icons]               â”‚
â”‚                                     â”‚
â”‚ â„¹ï¸ URL will be posted as comment   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Implementation Patterns

**Twitter Character Count Display**:
```typescript
// In TwitterPreview component

const isOverLimit = characterCount > 280;
const countColor = isOverLimit ? 'text-red-600' : 'text-gray-500';

<div className={`text-sm ${countColor}`}>
  {characterCount} / 280
</div>
```

**LinkedIn "See More" Truncation**:
```typescript
// In LinkedInPreview component

const [isExpanded, setIsExpanded] = useState(false);
const TRUNCATE_LENGTH = 140;

const displayContent = isExpanded || content.length <= TRUNCATE_LENGTH
  ? content
  : content.slice(0, TRUNCATE_LENGTH) + '...';

<div className="whitespace-pre-wrap">
  {displayContent}
  {!isExpanded && content.length > TRUNCATE_LENGTH && (
    <button
      onClick={() => setIsExpanded(true)}
      className="text-blue-600 ml-1"
    >
      see more
    </button>
  )}
</div>
```

**Responsive Preview Layout**:
```typescript
// In PreviewModal component

<DialogContent className="max-w-5xl">
  <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
    {twitterEnabled && <TwitterPreview {...} />}
    {linkedInEnabled && <LinkedInPreview {...} />}
  </div>
</DialogContent>
```

**Dynamic Preview Updates**:
- React's automatic re-rendering handles this - no special logic needed
- When parent form state changes (user typing), props passed to PreviewModal update
- PreviewModal and child components re-render automatically with new content

### Platform-Specific Styling

**Twitter Brand Colors**:
- Primary blue: `#1DA1F2`
- Use for accents, action button hover states
- Light background: `#F7F9F9` or similar

**LinkedIn Brand Colors**:
- Primary blue: `#0A66C2`
- Use for accents, action button hover states
- Light background: `#F3F2EF` or similar

**Avatar Placeholders**:
- Use shadcn/ui Avatar component with fallback initials
- Or use a generic user icon from lucide-react

### Testing

[Source: docs/architecture/testing-strategy.md#Unit Testing]

- **Test Level**: Unit tests for preview components
- **Tools**: Jest with React Testing Library
- **Testing Focus**:
  - Preview content rendering
  - Character count display
  - Truncation logic (LinkedIn "see more")
  - URL label display
  - Responsive layout behavior
  - Dynamic content updates

**Testing Requirements**:
- Test file: `components/features/PreviewModal.test.tsx`
- Test conditional rendering based on platform enabled flags
- Test truncation logic with various content lengths
- Mock shadcn/ui Dialog component if needed
- Verify accessibility attributes (ARIA labels, keyboard navigation)

### Accessibility Considerations

- Modal should trap focus when open
- ESC key should close modal
- Close button should have `aria-label="Close preview"`
- Preview containers should have semantic HTML (`<article>` or `role="article"`)
- Ensure sufficient color contrast for text and action buttons
- "see more" button should be keyboard accessible

### Implementation Notes

1. **Visual-Only Mockups**: The previews are for visualization only. Action buttons (like, comment, etc.) are non-functional and purely decorative.

2. **Avatar Placeholder**: Use a generic avatar with user's initials or a default user icon. In future, could integrate actual user profile data from Clerk.

3. **LinkedIn Truncation**: LinkedIn's mobile feed shows ~140 characters (first 2-3 lines), desktop shows ~220. Use 140 as a safe conservative estimate for the preview.

4. **URL Metadata**: In the actual published post, LinkedIn and Twitter may show URL previews with images/titles. Our preview just shows a simple label indicating the URL will be posted separately.

5. **Real-time Updates**: Because the preview modal receives live props from form state, it updates automatically as user types. This is a React feature - no additional logic needed.

6. **Performance**: For very frequent updates, consider debouncing preview updates if performance becomes an issue. However, for typical use cases, React's re-rendering should be fast enough.

7. **Mobile Experience**: On mobile, previews stack vertically. Ensure adequate spacing and scrollability within the modal.

8. **Future Enhancement**: Could add a "Copy Preview" button to copy the formatted preview text to clipboard for testing outside the app.

## Change Log

| Date       | Version | Description                 | Author        |
| :--------- | :------ | :-------------------------- | :------------ |
| 2025-11-03 | 1.0     | Initial story draft created | Scrum Master  |

## Dev Agent Record

_This section will be populated by the development agent during implementation._

### Agent Model Used

_To be populated by dev agent_

### Debug Log References

_To be populated by dev agent_

### Completion Notes

_To be populated by dev agent_

### File List

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_
